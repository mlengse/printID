function save_options(){const e=safeGetById("systemUrl"),t=safeGetById("puskesmasName"),s=safeGetById("modelPath");if(!e||!t)return void console.error("[options.js] Required input elements not found");const n={systemUrl:e.value,puskesmasName:t.value,modelPath:s?s.value:""};chrome.storage.local.set(n,function(){const e=safeGetById("status");e&&(e.textContent="✅ Pengaturan disimpan.",setTimeout(function(){e.textContent=""},2e3))})}function restore_options(){chrome.storage.local.get({systemUrl:"",puskesmasName:"",modelPath:""},function(e){const t=safeGetById("systemUrl"),s=safeGetById("puskesmasName"),n=safeGetById("modelPath");t&&(t.value=e.systemUrl),s&&(s.value=e.puskesmasName),n&&(n.value=e.modelPath)})}async function testModels(){const e=safeGetById("modelStatus"),t=safeGetById("modelPath");if(!e)return;e.style.display="block",e.className="model-status warning",e.innerHTML="⏳ Memeriksa model...";const s=t?.value||chrome.runtime.getURL("captcha-model/"),n=["captcha_ctc.onnx"],a=[];let o=!0;for(const e of n){const t=s.endsWith("/")?s+e:s+"/"+e;try{const s=await fetch(t,{method:"HEAD"});s.ok?a.push(`✅ ${e}`):(a.push(`❌ ${e} (HTTP ${s.status})`),o=!1)}catch(t){a.push(`❌ ${e} (${t.message})`),o=!1}}const d=s.endsWith("/")?s+"config.json":s+"/config.json";try{const e=await fetch(d);if(e.ok){const t=await e.json();a.push(`✅ config.json (${t.chars?.length||"?"} chars)`)}else a.push("⚠️ config.json (tidak ditemukan, akan gunakan default)")}catch(e){a.push(`⚠️ config.json (${e.message})`)}o?(e.className="model-status success",e.innerHTML=`<strong>✅ Model tersedia!</strong><br>${a.join("<br>")}<br><br>\n      <small>Model type: CNN-CTC End-to-End (Conv1D, no LSTM)</small>`):(e.className="model-status error",e.innerHTML=`<strong>⚠️ Model tidak ditemukan:</strong><br>${a.join("<br>")}<br><br>\n      <small>Pastikan file captcha_ctc.onnx sudah di-copy ke folder captcha-model/</small>`)}document.addEventListener("DOMContentLoaded",restore_options);const saveBtn=safeGetById("save");saveBtn?saveBtn.addEventListener("click",save_options):document.addEventListener("DOMContentLoaded",()=>{const e=safeGetById("save");e&&e.addEventListener("click",save_options)});const testBtn=safeGetById("testModels");testBtn?testBtn.addEventListener("click",testModels):document.addEventListener("DOMContentLoaded",()=>{const e=safeGetById("testModels");e&&e.addEventListener("click",testModels)});