function safeArrayText(e,t,a="b"){if(!e||!e[t])return"";const r=e[t].querySelector(a);return r?r.textContent.trim():""}if(void 0===window.puskesmasName&&(window.puskesmasName="PKM Default"),window.puskesmasListenerAdded||(window.puskesmasListenerAdded=!0,chrome.runtime.onMessage.addListener(e=>{"SET_PUSKESMAS_NAME"===e?.type&&(window.puskesmasName=e.puskesmasName||window.puskesmasName)})),0===$("#label2PDF").length){let e,t,a;function getPusk(e){return e?window.puskesmasName+" "+e:window.puskesmasName}function pasienUm(){const e=$("#tgllahir").val().split("-"),t=new Date(e[2]+"-"+e[1]+"-"+e[0]);let a=new Date,r=-1;for(;a>t;)a=new Date(a.setFullYear(a.getFullYear()-1)),r++;a=new Date(a.setFullYear(a.getFullYear()+1));let s=-1;for(;a>t;)a=new Date(a.setMonth(a.getMonth()-1)),s++;a=new Date(a.setMonth(a.getMonth()+1));let n=-1;for(;a>t;)a=new Date(a.setDate(a.getDate()-1)),n++;return r>0?r+" thn.":s>0?s+" bln.":n>0?n+" hr.":"error"}$("#obat2").length?a="obat2":$("#add_drug").length&&(a="add_drug"),$("button.cancel").length?$("button.cancel").after('<button id=label2PDF onclick="return false;" style="padding: 4px 5px 5px 30px; background: url('+chrome.runtime.getURL("print_16x16.png")+') white no-repeat 5px 6px; border: 1px solid #B2B2B2;  -webkit-border-radius : 4px; -moz-border-radius : 4px; border-radius: 4px; position: relative; top: 2px; margin: 0 0 0 2px;">Cetak Label</button><iframe name="labelframe" style="display: none;" width="400" height="300"></iframe>'):$("#idSimpan").length?$("#idSimpan").after('<button id=label2PDF onclick="return false;" style="padding: 4px 5px 5px 30px; background: url('+chrome.runtime.getURL("print_16x16.png")+') white no-repeat 5px 6px; border: 1px solid #B2B2B2;  -webkit-border-radius : 4px; -moz-border-radius : 4px; border-radius: 4px; position: relative; top: 2px; margin: 0 0 0 2px;">Cetak Label</button><iframe name="labelframe" style="display: none;" width="400" height="300"></iframe>'):$("a.back").length&&$("a.back").after('<button id=label2PDF onclick="return false;" style="margin : 10px 0 0 10px; padding : 5px 5px 5px 30px; border : 1px solid #ddd; -webkit-border-radius : 4px; background : url('+chrome.runtime.getURL("print_16x16.png")+') no-repeat center left; font: 11px/14px verdana, geneva, sans-serif;">Cetak Label</button><iframe name="labelframe" style="display: none;" width="400" height="300"></iframe>'),$("#label2PDF").bind("click",function(){let r,s,n,i,l,d,o,m,p,u,f,x,k,g,h=[],y={};const A=safeQuerySelector("#content > div.divkiri > fieldset.fd150 > div.divkiri");A&&(h=safeQuerySelectorAll("div",A),y={rm:safeArrayText(h,0).toUpperCase(),nik:safeArrayText(h,1),noKartu:safeArrayText(h,2),nama:safeArrayText(h,3),kk:safeArrayText(h,4),alamat:safeArrayText(h,5),jk:safeArrayText(h,6),desa:safeArrayText(h,7),tglLahir:safeArrayText(h,8),umur:safeArrayText(h,9),jp:window.puskesmasName+" "+safeArrayText(h,10)},r=y.tglLahir,s=y.nik,g=y.rm.substr(7,2),i=y.rm.substring(0,7),d=y.jk,o=y.alamat,p=y.jp,n=y.umur,u=d+", "+r+", "+n,x=y.nama,f=y.jp,t=!0);let b="#content > div.divkiri > fieldset.fd150";"obat2"===a&&(b+=" > div.divkiri");const c=safeQuerySelector(b);if(c)if(h=safeQuerySelectorAll("div",c),"obat2"===a)y={rm:safeArrayText(h,0).toUpperCase(),nik:safeArrayText(h,1),noKartu:safeArrayText(h,2),nama:safeArrayText(h,3),kk:safeArrayText(h,4),alamat:safeArrayText(h,5),jk:safeArrayText(h,6),desa:safeArrayText(h,7),tglLahir:safeArrayText(h,8),umur:safeArrayText(h,9),jp:window.puskesmasName+" "+safeArrayText(h,10)},r=y.tglLahir,s=y.nik,g=y.rm.substr(7,2),i=y.rm.substring(0,7),d=y.jk,o=y.alamat,p=y.jp,n=y.umur,u=d+", "+r+", "+n,x=y.nama,f=y.jp,t=!0;else if("add_drug"===a){const e=safeArrayText(h,14).split("/");y={rm:safeArrayText(h,5).toUpperCase(),nik:safeArrayText(h,6),noKartu:safeArrayText(h,7),nama:safeArrayText(h,8),kk:safeArrayText(h,9),alamat:safeArrayText(h,10),jk:safeArrayText(h,13),desa:"",tglLahir:e[0]||"",umur:e[1]||"",bb:safeArrayText(h,15),jp:window.puskesmasName+" "+safeArrayText(h,12)},r=y.tglLahir,s=y.nik,g=y.rm.substr(7,2),i=y.rm.substring(0,7),d=y.jk,o=y.alamat,p=y.jp,n=y.umur,u=d+", "+r+", "+n,x=y.nama,f=y.jp,t=!0}else{const e=safeArrayText(h,13).split("/");y={rm:safeArrayText(h,4).toUpperCase(),nik:safeArrayText(h,5),noKartu:safeArrayText(h,6),nama:safeArrayText(h,7),kk:safeArrayText(h,8),alamat:safeArrayText(h,9),jk:safeArrayText(h,12),desa:"",tglLahir:e[0]||"",umur:e[1]||"",jp:window.puskesmasName+" "+safeArrayText(h,11)},r=y.tglLahir,s=y.nik,g=y.rm.substr(7,2),i=y.rm.substring(0,7),d=y.jk,o=y.alamat,p=y.jp,n=y.umur,u=d+", "+r+", "+n,x=y.nama,f=y.jp,t=!0}for(;x&&x.length>30;)x=x.trim().split(" "),x.pop(),x=x.join(" ").trim();if(n&&!n.length)alert("mohon cek tgl lahir dan umur");else if(n){const e=Number(n.split("thn")[0].trim()),t=Number(n.split("thn")[1].split("bln")[0].trim()),a=Number(n.split("thn")[1].split("bln")[1].split("hr")[0].trim());e>0?n=e+" thn.":t>0?n=t+" bln.":a>0?n=a+" hr.":alert("usia tidak dapat dihitung")}if(n&&(u=d+", "+r+", "+n),i&&(k=drawBarcode("svg",i,{type:"Code 128"})),$("#sex").length&&$("#sex").val().length?(r=$("#tgllahir").val(),s=$("#nik").val(),n=pasienUm(),"error"===n?(void 0===e&&alert("tanggal lahir salah"),$("#tgllahir").focus()):(i=$("#patient_id").val().toUpperCase(),k=drawBarcode("svg",i,{type:"Code 128"}),g=i.substr(7,2),i=i.substr(0,7),l=$("#sex").val(),d=$('#jk > option[value="'+l+'"]').text(),o=$("#alamat").val(),m=$("#typepatient").val(),p=$('#jenispasien > option[value="'+m+'"]').text(),u=d+", "+r+", "+n,f=getPusk(p)),x=$("#VisitNama").length?$("#VisitNama").val():$("#namapasien").val(),t=!0):void 0===t?alert("data register masih kosong"):$("#patient_id")&&$("#patient_id").focus(),t){for($.CreateTemplate("inches",2.3622,1.5748,.0787402,.0787402,2.3622,1.5,1,1,.2,.05);o.length>30;)o=o.trim().split(" "),o.pop(),o=o.join(" ").trim();$(k).find("rect").map(function(){const e=0+.004481*$(this).attr("x"),t=.004481*$(this).attr("width");$.AddRect(e,.2,t,.35)}),$.AddText(.1,.62,i,14),$.AddText(.87,.62,g,10),$.AddText(.1,1.3,x,10),$.AddText(.1,1.17,s,10),$.AddText(.1,1.04,u,10),$.AddText(.1,.91,o,8),$.AddText(.1,.78,f,10),$.DrawPDF("labelframe")}})}if(0===$("#drug2PDF").length){let r,s;if($("#obat2").length?s="obat2":$("#add_drug").length&&(s="add_drug"),$(`#${s} > table.nested-table > tbody > tr`).length>1){$(`#${s}`).append('<iframe  id="drug2PDF" name="obatframe" style="display: none;" width="400" height="300"></iframe>'),r=[...document.getElementById(s).querySelectorAll("tr")].map(e=>{const t=[...e.querySelectorAll("td")];return t&&t[1]?{kode:t[0].textContent,nama:t[1].textContent,dosis:t[2].textContent,jml:t[3].textContent,puyer:t[4].textContent,pmt:t[5].textContent}:{}}),r[1]&&r[1].kode&&$(`#${s} > table.nested-table > tbody > tr:nth-child(1)`).append("<th width='20'>Label</th>");for(const[n,i]of Object.entries(r))if(Number(n)>0&&i.kode){const l=`${n}.${i.kode}`,d=Number(n)+1;$(`#${s} > table.nested-table > tbody > tr:nth-child(${d})`).append(`<td align="center" valign="top"><a href="" id="${l}" onclick="return false;"><img src="${chrome.runtime.getURL("drug_16x16.png")}" alt="Print" title="Print"></a></td>`),document.getElementById(`${l}`).addEventListener("click",clickLabel)}}function clickLabel(e){const t=Object.assign({},r[e.currentTarget.id.split(".")[0]]);t.ket="",t.ket2="",t.nama=t.nama.replace(/[()]/g," ");const a=safeQuerySelector(".tanggal"),n=(a?a.textContent:"").split(","),i=n[1]?n[1].trim().split("-")[0].trim():"",l=n[1]?n[1].trim().split("-")[1].trim():"";for(;t.nama.length>30;)t.nama=t.nama.trim().split(" "),t.ket=`${t.nama.pop()} ${t.ket}`,t.nama=t.nama.join(" ").trim();for(;t.dosis.length>25;)t.dosis=t.dosis.split(" "),t.ket2=`${t.dosis.pop()} ${t.ket2}`,t.dosis=t.dosis.join(" ").trim();let d="#content > div.divkiri > fieldset.fd150";"obat2"===s&&(d+=" > div.divkiri");const o=safeQuerySelector(d);if(!o)return void console.warn("[content_script] Patient container not found");const m=safeQuerySelectorAll("div",o);let p,u;for("obat2"===s?p={rm:safeArrayText(m,0).toUpperCase(),nik:safeArrayText(m,1),noKartu:safeArrayText(m,2),nama:safeArrayText(m,3),kk:safeArrayText(m,4),alamat:safeArrayText(m,5),jk:safeArrayText(m,6),desa:safeArrayText(m,7),tglLahir:safeArrayText(m,8),umur:safeArrayText(m,9),jp:window.puskesmasName+" "+safeArrayText(m,10)}:"add_drug"===s?(u=safeArrayText(m,14).split("/"),p={rm:safeArrayText(m,5).toUpperCase(),nik:safeArrayText(m,6),noKartu:safeArrayText(m,7),nama:safeArrayText(m,8),kk:safeArrayText(m,9),alamat:safeArrayText(m,10),jk:safeArrayText(m,13),desa:"",tglLahir:u[0]||"",umur:u[1]||"",bb:safeArrayText(m,15),jp:window.puskesmasName+" "+safeArrayText(m,12)}):(u=safeArrayText(m,13).split("/"),p={rm:safeArrayText(m,4).toUpperCase(),nik:safeArrayText(m,5),noKartu:safeArrayText(m,6),nama:safeArrayText(m,7),kk:safeArrayText(m,8),alamat:safeArrayText(m,9),jk:safeArrayText(m,12),desa:"",tglLahir:u[0]||"",umur:u[1]||"",jp:window.puskesmasName+" "+safeArrayText(m,11)});p.nama.length>28;)p.nama=p.nama.trim().split(" "),p.nama.pop(),p.nama=p.nama.join(" ").trim();if(p.umur.length){const e=Number(p.umur.split("thn")[0].trim()),t=Number(p.umur.split("thn")[1].split("bln")[0].trim()),a=Number(p.umur.split("thn")[1].split("bln")[1].split("hr")[0].trim());e>0?p.umur=e+" thn.":t>0?p.umur=t+" bln.":a>0?p.umur=a+" hr.":alert("usia tidak dapat dihitung")}else alert("mohon cek tgl lahir dan umur");const f=drawBarcode("svg",p.rm,{type:"Code 128"});p.rm=p.rm.substring(0,7),$.CreateTemplate("inches",2.75591,1.9685,.0787402,.0787402,2.6,1.8,1,1,.2,.05);let x=0;$(f).find("rect").map(function(){const e=0+.004481*$(this).attr("x"),t=.004481*$(this).attr("width");$.AddRect(e,1.2,t,.45),e>x&&(x=e)});let k=`${p.desa?`${p.desa} `:""}${p.alamat}`;for(k.length>30&&(k=p.alamat);k.length>30;)k=k.trim().split(" "),k.pop(),k=k.join(" ").trim();$.AddText(x+.05,1.2,p.rm,16),$.AddText(x+.05,1.5,`${i}`,7),$.AddText(x+.05,1.4,`${l}`,7),$.AddText(.1,1.08,p.nama,10),$.AddText(.1,.96,`${p.jp}`,8),$.AddText(.1,.85,`${p.jk} ${p.tglLahir.length?`[${p.tglLahir}] `:""}${p.umur}${p.bb?` ${p.bb}`:""}`,8),$.AddText(.1,.74,`${k}`,8),$.AddRect(.01,.69,70,.01),$.AddText(.1,.56,t.nama,11);let g=.25;if(t.ket.length){for(t.ket3="";t.ket.length>40;)t.ket=t.ket.split(" "),t.ket3=`${t.ket.pop()} ${t.ket3}`,t.ket=t.ket.join(" ");$.AddText(.2,.44,t.ket,8),t.ket3=t.ket3.trim(),t.ket3.length?($.AddText(.2,.34,t.ket3,8),g=0):g=.12}$.AddText(2.25,.38,`[${t.jml}]`,16),$.AddText(.1,.13+g,t.dosis,12),t.ket2.length&&$.AddText(.2,.03+g-.01,t.ket2,8),$.DrawPDF("obatframe")}}